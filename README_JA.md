# NAS-Subtitler


<div align="center">

**🚀 NASのメディアライブラリのための専用字幕ツール。**

**Languages:** [English](README.md) | [中文](README_CN.md) | [繁體中文](README_TW.md) | [Deutsch](README_DE.md) | [Español](README_ES.md) | [Français](README_FR.md) | [日本語](README_JA.md) | [한국어](README_KO.md) | [Русский](README_RU.md)

</div>

**字幕作業をNASに戻す｜Make your NAS talk.**

静かな週末の夜、あなたは再生ボタンを押したいだけ。NAS-Subtitlerはマッピングされた **`/data`** フォルダを見張ります：新しい動画を検出 → 音声をローカルでクリーンに分割 → **コンテキストを意識した翻訳**を伴う自動書き起こし → 元のディレクトリにきれいな字幕を書き戻し。進捗バーの見張りは不要、メディアがサーバーの外へ出ることもありません。  
この「当然こうあるべき」という体験は、セルフホスティングの精神から生まれます——**ローカルコントロール、プライバシー第一。Your media, your server, your way.**

## ✅ 対象ユーザー（典型的なシナリオ）

**NAS（Jellyfin / Plex / Emby）**  

- 関心：ライブラリ全体の自動化、規範的な命名、プラグ＆プレイ  
- 期待：ディレクトリをマッピング → キュー → 同名のSRTを書き戻し、既存のメディア秩序を乱さない

**プライバシーとコンプライアンスを重視する組織（法務／医療研修など）**  

- 関心：ローカル計算、監査可能性  
- 期待：必要な場合のみ、選択した互換エンドポイントへ**最小限の音声セグメント**を送信

**オープンソース愛好家・拡張開発者**  

- 関心：置換可能、拡張可能  
- 期待：Docker-first、OpenAI互換API、明確なロードマップ、PRしやすい

---

## ✨ NAS-Subtitlerを選ぶ理由（平易な説明）

- **ローカル優先＆プライバシーに優しい**  
NAS上の **Silero-VAD（ONNX）** で「どこで話しているか」を検出し、音声をクリーンかつ軽量に分割してから、文字起こしと翻訳を実行——**動画全体は決して外に出ません**。
- **コンテキストを意識した翻訳体験**  【計画中】
途切れ途切れの「文ごと機械翻訳」ではありません。**意味ウィンドウで結合→翻訳→再配置**し、字幕が「人が書いたように」滑らかに読めます——映画にもオンライン講座にも最適。
- **ライブラリ単位の自動化、家電のように信頼できる**  
ディレクトリ監視 → キュー調整 → 失敗時の再試行 → **同名SRTを書き戻し**、Jellyfin/Plex/Embyの認識ルールと自然に互換。
- **多言語＆バイリンガル出力**  【計画中】
一度に複数言語の字幕を生成；**中英対訳**（同一ファイルまたは分割ファイル）を選択可能、学習にも視聴にも便利。
- **オープンソース＆Docker-first**  
透明で監査可能；1コマンドで起動；依存関係と更新のリズムが明確。FFmpegがA/V抽出と処理を担当——成熟したエコシステムでクロスプラットフォームに安定。

---

## 🧩 仕組み（How it works）

```
/data (videos)
   └─ Watch  →  FFmpegで音声抽出  →  ローカルのSilero-VAD（ONNX）で分割
                   └→ セグメント認識（ASR） → whisper-v3で書き起こし → 句読点／タイムライン補正【計画中】
                   └→ 字幕を書き込む（SRT / VTT / ASS、必要に応じて）
Web UI：タスク開始／進捗確認／ワンクリックでキャンセル         DB：タスクと設定を永続化
```

- **FFmpeg**：音声抽出／フォーマット処理（業界標準）  
- **Silero-VAD（ONNX）**：高速・軽量・高精度の音声活動検出（VAD）、NASに最適  
- **OpenAI互換プロトコル**：APIキーやエンドポイントを持ち込み可；コストと速度を制御

---

## 🚀 クイックスタート（Docker Compose）

1. **前提**：NASがDockerをサポートしていること  
2. **クローンまたはイメージ取得**：`git clone ...`（もしくは直接イメージを取得）  
3. **起動**：

```yaml
services:
  nas-subtitler:
    image: ghcr.io/yourname/nas-subtitler:latest
    container_name: nas-subtitler
    environment:
      - TZ=Asia/Shanghai
      - MOUNT_DIR=/data
    volumes:
      - /path/to/videos:/data
      - /path/to/config:/app/data/config
    ports:
      - "3000:3000"
    restart: unless-stopped
```

5. **アクセス**：`http://<NAS-IP>:3000` を開いてWeb UIへ  
6. **設定**：設定ページでOpenAIのAPIキーを入力

---

## 🖱️ 使い方（5分でセットアップ）

1. **ディレクトリ選択**：動画フォルダを指定（例：`/data/Movies`）  
2. **タスク開始**：［Start Processing］をクリックし、書き起こし／翻訳の対象言語、バイリンガル出力などを選択  
3. **進捗監視**：［Tasks］ページでキューと処理状況を確認；ワンクリックでキャンセル／再試行  
4. **出力**：字幕は**動画と同じフォルダ**に生成（例：`movie.srt` や `movie.zh-en.srt`）  
5. **メディアサーバーの認識**：ライブラリを再スキャンして字幕が反映されるのを確認

---

## 🧰 機能一覧

- **真のオープンソース**：完全に透明でNAS上でローカル実行、データのプライバシーを保証  
- **セルフサーブ（BYO-Key）**：自分のOpenAI APIキーで書き起こしと翻訳を実行——**完全な制御**  
- **コンテキスト翻訳［計画中］**：意味ウィンドウ単位で処理；不自然さのない一貫した自然な翻訳  
- **バイリンガル対応**：中英対訳（同一ファイル／別ファイル）を選択可能  
- **バッチ処理**：映画やドラマの字幕をワンクリックで自動生成  
- **多言語対応**：多言語認識の改善と**句読点補正**で読みやすさ向上

---

## 🧱 依存関係（エンジニア向け）

- **FFmpeg**：A/V抽出と処理  
- **Silero-VAD（ONNX）**：音声活動検出（VAD）  
- **Node.js関連パッケージ**：Prisma（DB）、EJS（テンプレート）など  
- **OpenAI API（セルフサーブ）**：互換プロトコルに準拠するエンドポイントを切り替え可能

---

## 🗒️ 変更履歴（Changelog）

- **v1.0.0**  
  - **バッチタスクの同時実行制御**を追加、より高速で安定した処理  
  - UIの不具合やエッジケースのエラーを修正

> 変更の全一覧はWeb UIの「View Changelog」で確認できます。

---

## 🧭 ロードマップ（Roadmap）

- [ ] **翻訳** → エンドツーエンドの書き起こし + LLM翻訳、実用性を確保
- [ ] **翻訳の二次調整** → 既訳字幕をLLMでリファイン
- [ ] **タイムライン最適化** → 字幕のタイミング合わせを改善
- [ ] **軽量な並列認識** → レート制限付き並列で長尺動画を加速  
- [ ] **Webプレビュー** → タイムライン／波形で迅速に検証  
- [ ] **対応プロバイダ拡充** → さらなるベンダーをサポート

---

## 🤝 コントリビュート＆コミュニティ

コントリビューション歓迎！リポジトリをフォークしてPull Requestを送ってください。  
大きな変更はIssueで事前に議論を；プラットフォームテンプレート（Synology/Unraid/TrueNAS）、プロバイダアダプタ、i18nの提供も歓迎します。

---

## 📝 ライセンス

本プロジェクトは **MIT** ライセンス（リポジトリ記載）です。

---

## 🙏 謝辞＆参考

- FFmpeg — 技術的基盤
- Silero-VAD（ONNX）