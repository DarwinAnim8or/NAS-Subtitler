# NAS-Subtitler

**把字幕工作，放回你的 NAS｜Make your NAS talk.**

周末夜，你只想按下开始。NAS-Subtitler 守在你映射的 **`/data`** 文件夹旁：发现新视频 → 本地切好语音片段 → 自动转写与**上下文翻译** → 在原目录**写回干净的字幕**。你无需盯进度条，也不必担心素材出门。  
这种“理所当然”的体验，来自自托管世界的共同信念——**本地控制，隐私优先，Your media, your server, your way**。

---

## ✅ 我们为谁而做（典型场景）

**NAS（Jellyfin / Plex / Emby）**  

- 关心：整库自动化、规范命名、即插即用  
- 期望：映射目录→队列→写回同名 SRT，不打扰现有媒体秩序

**注重隐私与合规的组织（法务/医疗培训等）**  

- 关心：本地计算、可审计  
- 期望：只在必要时发送**最小化音频片段**给你自选的兼容端点

**开源爱好者与二开者**  

- 关心：可替换、可扩展  
- 期望：Docker-first、OpenAI 兼容接口、清晰 roadmap、容易提 PR

---

## ✨ 为什么选择 NAS-Subtitler（人话版卖点）

- **本地优先 & 隐私友好**  
先用 **Silero-VAD（ONNX）** 在 NAS 上判断“哪里有人在说话”，把音频切得干净、轻量，再去识别与翻译，**整段视频永不外传**。
- **上下文感知的翻译体验**  【规划中】
不是“逐句割裂”的机翻，而是按语义窗口**合并 → 翻译 → 回填**，让整条字幕“像是人写的”一样顺滑——看电影与网课都不出戏。
- **库级自动化，像家电一样可靠**  
看护目录 → 队列调度 → 失败重试 → **写回同名 SRT**，与 Jellyfin/Plex/Emby 的识别规则天然契合。
- **多语言 & 双语输出**  【规划中】
一次生成多语言字幕；可选**中英对照**（同文件或分文件），学习与观影两相宜。
- **Open-source & Docker-first**  
透明可审计；一条命令起服务；依赖与更新节奏清晰。FFmpeg 负责音视频抽取与处理，生态成熟、跨平台稳定。

---

## 🧩 工作原理（How it works）

```
/data (videos)
   └─ Watch  →  FFmpeg 抽音频  →  本地 Silero-VAD(ONNX) 切片
                   └→ 分段识别（ASR） → 调用whisper-v3转写 → 标点/时轴修正【规划中】
                   └→ 写回字幕（SRT / VTT / ASS，按需）
Web UI：开始任务 / 看进度 / 一键取消         DB：任务与配置持久化
```

- **FFmpeg**：音频抽取 / 格式处理（行业事实标准）  
- **Silero-VAD（ONNX）**：快速、轻量、准确的语音活动检测，适合 NAS 场景  
- **OpenAI 兼容协议**：自带 API Key 或自选端点，成本与速度皆可控

---

## 🚀 快速开始（DockerCompose）

1. **前提**：NAS 支持 Docker  
2. **克隆或拉镜像**：`git clone ...`（或直接拉镜像）  
3. **启动**：

```yaml
services:
  nas-subtitler:
    image: ghcr.io/yourname/nas-subtitler:latest
    container_name: nas-subtitler
    environment:
      - TZ=Asia/Shanghai
      - MOUNT_DIR=/data
    volumes:
      - /path/to/videos:/data
      - /path/to/config:/app/data/config
    ports:
      - "3000:3000"
    restart: unless-stopped
```

5. **访问**：打开 `http://<NAS-IP>:3000` 进入 Web 界面
6. **设置**：进入设置页面填入openai apikey

---

## 🖱️ 使用（5 分钟上手）

1. **选择目录**：指向你的影片文件夹（如 `/data/Movies`）  
2. **启动任务**：点击“开始处理”，选择识别与翻译目标语言、双语输出等  
3. **监控进度**：在“任务”页面查看队列与处理状态，支持一键取消/重试  
4. **输出**：字幕会生成在**视频同目录**（`movie.srt` 或 `movie.zh-en.srt` 等）  
5. **媒体服识别**：重扫库即可看到字幕生效

---

## 🧰 特点一览

- **真正开源**：完全透明，可在 NAS 本地运行，确保数据隐私  
- **自助模式（BYO-Key）**：使用你的 OpenAI API Key 完成字幕转写与翻译，**完全掌控**  
- **上下文翻译【规划中】**：按语义窗口处理，译文连贯自然、不突兀不割裂  
- **双语支持**：可选中英对照（同文件或分文件）  
- **批量处理**：一键为电影/剧集自动生成字幕  
- **多语言支持**：优化多语种识别与**标点修复**，读起来更顺畅

---

## 🧱 依赖（面向工程师）

- **FFmpeg**：音视频抽取与处理  
- **Silero-VAD（ONNX）**：语音活动检测（VAD）  
- **Node.js 及相关包**：如 Prisma（数据库）、EJS（模板）等  
- **OpenAI API（自助模式）**：遵循兼容协议的端点均可切换

---

## 🗒️ 更新日志（Changelog）

- **v1.0.0**  
  - 新增**批量任务并发控制**，处理更快更稳  
  - 修复若干 UI 问题与边缘场景错误

> 完整变更请在 Web 界面点击“查看更新日志”。

---

## 🧭 版本计划（Roadmap）

- [ ] **翻译** → 端到端转写 + 大模型翻译，确保可用
- [ ] **翻译二次润色** → 使用AI大模型对已翻译字幕进行二次顺色
- [ ] **时间轴优化*** → 字幕时间轴对齐优化
- [ ] **轻并发识别** → 分段限流并行，加速长片处理  
- [ ] **Web 预览** → 时间轴/波形快速校验
- [ ] **更多供应商** → 支持更多的供应商

---

## 🤝 贡献 & 交流

欢迎贡献代码！请 fork 仓库并提交 Pull Request。  
建议先开 Issue 讨论较大的变更；欢迎提供平台模板（Synology/Unraid/TrueNAS）、Provider 适配与 i18n。

---

## 📝 许可

本项目采用 **MIT** 许可（以仓库为准）。

---

## 🙏 致谢与参考

- FFmpeg — 技术基石
- Silero-VAD（ONNX）